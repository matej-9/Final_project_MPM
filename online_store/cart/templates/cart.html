{% extends 'homepage.html' %}
{% load static %}

{% block title %}
Cart
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'cart.css' %}">
{% endblock %}

{% block content %}

<div>
<ul class="cart">
{% for cart_item in cart %}
	<li class="product">
    {% if cart_item.product.image %}
            <img src="{{ cart_item.product.image.url }}" alt="{{ cart_item.product.name }}" style="max-width:200px; height:auto;">
            {% else %}
            <em>No image available</em>
    {% endif %}
        <div class="details">
            <h3>{{ cart_item.product.name }} </h3>
            <button onclick="updateQuantity({{ cart_item.id }},'minus')">-</button>
            <p id="quantity-{{ cart_item.id }}">{{ cart_item.quantity }}</p>
            <button onclick="updateQuantity({{ cart_item.id }},'plus')">+</button>
            <span class="price">{{ cart_item.product.price }} € / ks</span>
        </div>
    <div class="finalprice">
        <span id="total-{{ cart_item.id }}">{{ cart_item.get_total_price }} €</span>
    </div>
    </li>
    <li>
    <button type="submit">Zaplatiť</button>
    </li>
{% endfor %}
</ul>
</div>
    <script>
function updateQuantity(itemId, action) {
    // AJAX request
    const formData = new FormData();
    formData.append('item_id', itemId);
    formData.append('action', action);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

    fetch('{% url "update_cart" %}', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.deleted) {
            // hide item if deleted
            document.getElementById('item-' + itemId).style.display = 'none';
        } else {
            // upadete quantity and price
            document.getElementById('quantity-' + itemId).textContent = data.quantity;
            document.getElementById('total-' + itemId).textContent = data.total + ' €';
        }
    })
    .catch(error => {
        alert('Chyba pri aktualizácii košíka!');
        console.log(error);
    });
}
    </script>
{% endblock %}